#!/bin/bash

# Linux → Windows（支持选中和快捷键复制，无中文乱码）
wl-paste --watch bash -c 'iconv -f UTF-8 -t UTF-16LE | clip.exe' &
wl-paste --watch --primary bash -c 'iconv -f UTF-8 -t UTF-16LE | clip.exe' &

# Windows → Linux（强制 UTF-8 输出，防乱码）
last=""
while true; do
    current=$(powershell.exe -NoProfile -Command "[Console]::OutputEncoding = [System.Text.Encoding]::UTF8; Get-Clipboard -Raw" 2>/dev/null | tr -d '\r')
    if [[ "$current" != "$last" ]] && [[ -n "$current" ]]; then
        echo -n "$current" | wl-copy --primary
        last="$current"
    fi
    sleep 0.3
done